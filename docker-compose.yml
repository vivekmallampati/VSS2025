services:
  excel-import:
    build: .
    container_name: vss2025-excel-import
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
      # Mount the latest Registrations_11_29.xlsx file
      - ./dataprocessing/Registrations_11_29.xlsx:/app/dataprocessing/Registrations_11_29.xlsx:ro
    environment:
      - NODE_ENV=production
      # Default Excel file path (can be overridden)
      - EXCEL_FILE_PATH=/app/dataprocessing/Registrations_11_29.xlsx
      # Service account path (defaults to /app/secrets/serviceAccountKey.json)
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=import
    command: node firestore-utils.js import
    # The script will upload Registrations_11_29.xlsx to Firestore with normalized structure

  approve-registrations:
    build: .
    container_name: vss2025-approve-registrations
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
    command: node approve_registrations.js
    # Approves newly approved Praveshika IDs by updating status field

  cancel-registrations:
    build: .
    container_name: vss2025-cancel-registrations
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
    command: node cancel_registrations.js
    # Cancels registrations by updating status field to 'Cancelled'

  sync-email-to-uids:
    build: .
    container_name: vss2025-sync-email-to-uids
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
    command: node sync_email_to_uids.js
    # Syncs emailToUids collection with all registrations to ensure perfect sync

  sync-user-associated-registrations:
    build: .
    container_name: vss2025-sync-user-associated-registrations
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
    command: node sync_user_associated_registrations.js
    # Syncs associatedRegistrations field in users collection based on emailToUids

  normalize-field-names:
    build: .
    container_name: vss2025-normalize-field-names
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=normalize
    command: node firestore-utils.js normalize
    # Normalizes field names for ALL participant records from capitalized/multi-word format to camelCase

  cleanup-invalid-fields:
    build: .
    container_name: vss2025-cleanup-invalid-fields
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=cleanup
    command: node firestore-utils.js cleanup
    # Removes fields with invalid Firestore characters (* ~ / [ ]) from all registrations

  find-negative-phones:
    build: .
    container_name: vss2025-find-negative-phones
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=find-negative-phones
    command: node firestore-utils.js find-negative-phones
    # Finds all phone numbers that are negative numbers

  remove-fields:
    build: .
    container_name: vss2025-remove-fields
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=remove-fields
    command: node firestore-utils.js remove-fields
    # Removes "Shreni for Sorting" and "Registration Lookup Helper" fields from all registrations

  reject-status:
    build: .
    container_name: vss2025-reject-status
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=reject-status
    command: node firestore-utils.js reject-status
    # Updates status to "Rejected" for specific participant IDs

  cancel-status:
    build: .
    container_name: vss2025-cancel-status
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=cancel-status
    command: node firestore-utils.js cancel-status
    # Updates status to "Cancelled" for specific participant IDs

