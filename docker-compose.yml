services:
  excel-import:
    build: .
    container_name: vss2025-excel-import
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
      # Mount the latest Registrations_11_29.xlsx file
      - ./dataprocessing/Registrations_12_19.xlsx:/app/dataprocessing/Registrations_12_19.xlsx:ro
    environment:
      - NODE_ENV=production
      # Default Excel file path (can be overridden)
      - EXCEL_FILE_PATH=/app/dataprocessing/Registrations_12_19.xlsx
      # Service account path (defaults to /app/secrets/serviceAccountKey.json)
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=import
    command: node firestore-utils.js import
    # The script will upload Registrations_11_29.xlsx to Firestore with normalized structure

  approve-registrations:
    build: .
    container_name: vss2025-approve-registrations
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
    command: node approve_registrations.js
    # Approves newly approved Praveshika IDs by updating status field

  cancel-registrations:
    build: .
    container_name: vss2025-cancel-registrations
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
    command: node cancel_registrations.js
    # Cancels registrations by updating status field to 'Cancelled'

  sync-email-to-uids:
    build: .
    container_name: vss2025-sync-email-to-uids
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
    command: node sync_email_to_uids.js
    # Syncs emailToUids collection with all registrations to ensure perfect sync

  sync-user-associated-registrations:
    build: .
    container_name: vss2025-sync-user-associated-registrations
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
    command: node sync_user_associated_registrations.js
    # Syncs associatedRegistrations field in users collection based on emailToUids

  normalize-field-names:
    build: .
    container_name: vss2025-normalize-field-names
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=normalize
    command: node firestore-utils.js normalize
    # Normalizes field names for ALL participant records from capitalized/multi-word format to camelCase

  cleanup-invalid-fields:
    build: .
    container_name: vss2025-cleanup-invalid-fields
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=cleanup
    command: node firestore-utils.js cleanup
    # Removes fields with invalid Firestore characters (* ~ / [ ]) from all registrations

  find-negative-phones:
    build: .
    container_name: vss2025-find-negative-phones
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=find-negative-phones
    command: node firestore-utils.js find-negative-phones
    # Finds all phone numbers that are negative numbers

  remove-fields:
    build: .
    container_name: vss2025-remove-fields
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=remove-fields
    command: node firestore-utils.js remove-fields
    # Removes "Shreni for Sorting" and "Registration Lookup Helper" fields from all registrations

  reject-status:
    build: .
    container_name: vss2025-reject-status
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=reject-status
    command: node firestore-utils.js reject-status
    # Updates status to "Rejected" for specific participant IDs

  cancel-status:
    build: .
    container_name: vss2025-cancel-status
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=cancel-status
    command: node firestore-utils.js cancel-status
    # Updates status to "Cancelled" for specific participant IDs

  approve-status:
    build: .
    container_name: vss2025-approve-status
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=approve-status
    command: node firestore-utils.js approve-status
    # Updates status to "Approved" for specific participant IDs

  migrate-non-shibirarthi:
    build: .
    container_name: vss2025-migrate-non-shibirarthi
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=migrate-non-shibirarthi
    command: node firestore-utils.js migrate-non-shibirarthi
    # Migrates volunteers and admins to nonShibirarthiUsers collection

  migrate-cancelled:
    build: .
    container_name: vss2025-migrate-cancelled
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=migrate-cancelled
    command: node firestore-utils.js migrate-cancelled
    # Migrates cancelled/rejected registrations to cancelledRegistrations collection

  migrate-specific-ids-to-cancelled:
    build: .
    container_name: vss2025-migrate-specific-ids-to-cancelled
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=migrate-specific-ids-to-cancelled
    command: node firestore-utils.js migrate-specific-ids-to-cancelled
    # Migrates specific participant IDs to cancelledRegistrations collection

  migrate-specific-ids-from-cancelled:
    build: .
    container_name: vss2025-migrate-specific-ids-from-cancelled
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=migrate-specific-ids-from-cancelled
    command: node firestore-utils.js migrate-specific-ids-from-cancelled
    # Reverse migration: Migrates specific participant IDs from cancelledRegistrations back to registrations

  delete-checkins-by-type:
    build: .
    container_name: vss2025-delete-checkins-by-type
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=delete-checkins-by-type
    command: node firestore-utils.js delete-checkins-by-type
    # Deletes checkins with checkinType: registration, shulk_paid, kit_collected

  import-volunteers:
    build: .
    container_name: vss2025-import-volunteers
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
      # Mount the volunteers CSV/Excel file
      - ./dataprocessing/volunteers.csv:/app/dataprocessing/volunteers.csv:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - VOLUNTEER_CSV_PATH=/app/dataprocessing/volunteers.csv
      - COMMAND=import-volunteers
    command: node firestore-utils.js import-volunteers
    # Imports/updates volunteers with role and volunteerTeams from CSV/XLSX

  find-duplicates:
    build: .
    container_name: vss2025-find-duplicates
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=find-duplicates
    command: node firestore-utils.js find-duplicates
    # Finds all duplicates (by name+email and last 4 digits)

  find-duplicates-name-email:
    build: .
    container_name: vss2025-find-duplicates-name-email
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=find-duplicates-name-email
    command: node firestore-utils.js find-duplicates-name-email
    # Finds duplicates by name and email

  find-duplicates-last4:
    build: .
    container_name: vss2025-find-duplicates-last4
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=find-duplicates-last4
    command: node firestore-utils.js find-duplicates-last4
    # Finds duplicates by last 4 digits of PraveshikaID

  normalize-zones:
    build: .
    container_name: vss2025-normalize-zones
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=normalize-zones
    command: node firestore-utils.js normalize-zones
    # Normalizes zones to AF, AM, AR, AU, EU, AS format

  normalize-dates:
    build: .
    container_name: vss2025-normalize-dates
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=normalize-dates
    command: node firestore-utils.js normalize-dates
    # Normalizes pickup/dropoff dates to DD-MMM-YYYY format

  normalize-pickup-locations:
    build: .
    container_name: vss2025-normalize-pickup-locations
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=normalize-pickup-locations
    command: node firestore-utils.js normalize-pickup-locations
    # Normalizes pickup locations to standard dropdown options

  normalize-post-tour:
    build: .
    container_name: vss2025-normalize-post-tour
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=normalize-post-tour
    command: node firestore-utils.js normalize-post-tour
    # Normalizes post tour options (Kandakurti->None, etc.)

  normalize-all:
    build: .
    container_name: vss2025-normalize-all
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - COMMAND=normalize-all
    command: node firestore-utils.js normalize-all
    # Runs all normalization functions (zones, dates, pickup locations, post tour)

  export-travel-team:
    build: .
    container_name: vss2025-export-travel-team
    volumes:
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
      - ./exports:/app/exports
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - OUTPUT_PATH=/app/exports/travel_team_data.csv
      - COMMAND=export-travel-team
    command: node firestore-utils.js export-travel-team
    # Exports transportation/travel team CSV to ./exports/travel_team_data.csv

  export-post-tour-team:
    build: .
    container_name: vss2025-export-post-tour-team
    volumes:
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
      - ./exports:/app/exports
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - OUTPUT_PATH=/app/exports/post_tour_team_data.csv
      - COMMAND=export-post-tour-team
    command: node firestore-utils.js export-post-tour-team
    # Exports post-tour team CSV to ./exports/post_tour_team_data.csv

  bulk-update:
    build: .
    container_name: vss2025-bulk-update
    volumes:
      # Mount the service account key from your local machine
      - ./serviceAccountKey.json:/app/secrets/serviceAccountKey.json:ro
      # Mount the bulk update CSV/Excel file
      - ./dataprocessing/bulk_update.csv:/app/dataprocessing/bulk_update.csv:ro
    environment:
      - NODE_ENV=production
      - SERVICE_ACCOUNT_PATH=/app/secrets/serviceAccountKey.json
      - UPDATE_CSV_PATH=/app/dataprocessing/bulk_update.csv
      - COMMAND=bulk-update
    command: node firestore-utils.js bulk-update
    # Bulk updates registrations from CSV/XLSX
    # CSV format: First column = Praveshika ID, remaining columns = field names
    # Example: Praveshika ID, accommodation, ganaNumber, vahiniNumber
    #          AFBA1237, Hostel A, 5, 12

